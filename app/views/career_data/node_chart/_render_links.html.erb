<script>
// Function to render links based on provided link data
function renderLinks(svg, linkData, nodeDataMap, levelSpacing) {
  // Ensure linkData exists and is an array
  if (!Array.isArray(linkData) || linkData.length === 0) {
    console.warn("No link data available for rendering.");
    return;
  }

  console.log(`Rendering ${linkData.length} links...`);

  const group = svg.append("g").attr("class", "links-group");

  // Render links
  group
    .selectAll(".link")
    .data(linkData)
    .enter()
    .append("line")
    .attr("class", "link")
    .attr("x1", 0)
    .attr("y1", (d) => {
      const sourceNode = nodeDataMap[d.source];
      if (!sourceNode) {
        console.error(`Source node with ID ${d.source} not found.`);
        return 0; // Default to 0 to avoid errors
      }
      return (sourceNode.level - 1) * levelSpacing;
    })
    .attr("x2", 0)
    .attr("y2", (d) => {
      const targetNode = nodeDataMap[d.target];
      if (!targetNode) {
        console.error(`Target node with ID ${d.target} not found.`);
        return 0; // Default to 0 to avoid errors
      }
      return (targetNode.level - 1) * levelSpacing;
    })
    .attr("stroke", "#333")
    .attr("stroke-width", 2)
    .attr("marker-end", "url(#arrowhead-solid)")
    .style("cursor", "pointer")
    .on("click", function (event, d) {
      // Show modal with link data
      console.log("Link clicked:", d);

      // Update modal content
      document.getElementById("modal-source").textContent =
        nodeDataMap[d.source]?.name || "N/A";
      document.getElementById("modal-target").textContent =
        nodeDataMap[d.target]?.name || "N/A";
      document.getElementById("modal-avg-salary").textContent = `${
        d.avg_salary?.toLocaleString() || "N/A"
      }`;
      document.getElementById("modal-avg-bonus").textContent = `${
        d.avg_bonus?.toLocaleString() || "N/A"
      }`;
      document.getElementById("modal-avg-total-comp").textContent = `${
        d.avg_total_comp?.toLocaleString() || "N/A"
      }`;
      document.getElementById("modal-avg-comp-per-hour").textContent = `${
        d.avg_comp_per_hour?.toFixed(2) || "N/A"
      }`;

      // Show the modal using Bootstrap
      new bootstrap.Modal(document.getElementById("linkModal")).show();
    });
}



</script>
