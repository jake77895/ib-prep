<div class="row">
  <!-- Industry Breakdown -->
  <div class="col-md-6 mb-4">
    <div class="card shadow-sm">
      <div class="card-header bg-dark text-white">
        <h3 class="mb-0">Industry Breakdown</h3>
      </div>
      <div class="card-body">
        <canvas id="industryChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Geographic Distribution -->
  <div class="col-md-6 mb-4">
    <div class="card shadow-sm">
      <div class="card-header bg-dark text-white">
        <h3 class="mb-0">Geographic Distribution</h3>
      </div>
      <div class="card-body">
        <canvas id="geographyChart"></canvas>
      </div>
    </div>
  </div>
</div>

<div class="card shadow-sm mb-4">
  <div class="card-header bg-dark text-white">
    <h3 class="mb-0">School Comparison</h3>
  </div>
  <div class="card-body" style="height: 400px;">
    <canvas id="schoolComparisonChart"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Register the annotation plugin
  Chart.register(ChartAnnotation);
  
  const ctx = document.getElementById('schoolComparisonChart').getContext('2d');
  
  // Dummy data
  const data = {
    labels: ['Harvard', 'Wharton', 'Stanford', 'Columbia', 'Chicago Booth', 'MIT Sloan', 'Northwestern Kellogg', 'Berkeley Haas'],
    values: [98, 97, 96, 95, 94, 93, 92, 91],
    average: 94.5,
    selectedSchool: 'Harvard'  // This would be dynamic based on selection
  };

  // Create gradient for the selected school
  const selectedSchoolColor = ctx.createLinearGradient(0, 0, 0, 400);
  selectedSchoolColor.addColorStop(0, '#007bff');
  selectedSchoolColor.addColorStop(1, '#0056b3');

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: data.labels,
      datasets: [{
        data: data.values,
        backgroundColor: data.labels.map(label => 
          label === data.selectedSchool ? selectedSchoolColor : '#e9ecef'
        ),
        borderWidth: 0,
        borderRadius: 4
      }]
    },
    options: {
      indexAxis: 'y',
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
        annotation: {
          annotations: {
            line1: {
              type: 'line',
              xMin: data.average,
              xMax: data.average,
              borderColor: '#dc3545',
              borderWidth: 2,
              borderDash: [5, 5],
              label: {
                content: `Average: ${data.average}%`,
                display: true,
                position: 'start'
              }
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          grid: {
            display: false
          }
        },
        x: {
          beginAtZero: true,
          grid: {
            color: '#f0f0f0'
          },
          min: 85,  // Start scale at 85%
          max: 100, // End at 100%
          ticks: {
            callback: function(value) {
              return value + '%';
            }
          }
        }
      }
    }
  });
});
</script>

<%= content_for :javascript do %>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Chart.js initialization for industry breakdown
      const industryCtx = document.getElementById('industryChart').getContext('2d');
      new Chart(industryCtx, {
          type: 'pie',
          data: {
              labels: ['Consulting', 'Finance', 'Technology', 'Other'],
              datasets: [{
                  data: [35, 25, 20, 20],
                  backgroundColor: [
                      '#007bff',
                      '#28a745',
                      '#ffc107',
                      '#dc3545'
                  ]
              }]
          }
      });

      // Chart.js initialization for geographic distribution
      const geoCtx = document.getElementById('geographyChart').getContext('2d');
      new Chart(geoCtx, {
          type: 'pie',
          data: {
              labels: ['Northeast US', 'West Coast', 'International', 'Other US'],
              datasets: [{
                  data: [45, 30, 15, 10],
                  backgroundColor: [
                      '#007bff',
                      '#28a745',
                      '#ffc107',
                      '#dc3545'
                  ]
              }]
          }
      });
    });
  </script>

  <%= content_for :head do %>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
  <% end %>
<% end %> 
